@model CreateCheckoutViewModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Checkout";
}

@if (Model.Products is null || !Model.Products.Any())
{
    <div class="container" style="margin-top: 150px; margin-bottom: 100px">
        <div class="row">
            <div class="col-12 text-center">
                <h2>Your cart is empty.</h2>
                <p>Please add some products to your cart before proceeding to checkout.</p>
                <a class="btn btn-primary" asp-action="Index" asp-controller="Shop">
                    Continue
                    Shopping
                </a>
            </div>
        </div>
    </div>
    return;
}

<!--breadcrumbs area start-->
<div class="breadcrumbs_area breadcrumbs_other" style="margin-top: 100px">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="breadcrumb_content text-center">
                    <ul>
                        <li><a asp-action="Index" asp-controller="Home">home</a></li>
                        <li><a asp-action="Index" asp-controller="Shop">shop</a></li>
                    </ul>
                    <h3>checkout</h3>
                </div>
            </div>
        </div>
    </div>
</div>
<!--breadcrumbs area end-->
<!--Checkout page section-->
<div class="checkout_section" id="accordion">
    <div class="container">
        <div class="returning_coupon_area">
            <div class="row d-flex justify-content-end">
                <div class="col-lg-5 col-md-6">
                    <div class="user-actions">
                        <h3>
                            <i class="fa fa-comment-o" aria-hidden="true"></i>
                            Have a Coupon ?
                            <a class="Returning" href="#" data-toggle="collapse"
                               data-target="#checkout_coupon2" aria-expanded="true">
                                Click here to
                                enter your code
                            </a>
                        </h3>
                        <div id="checkout_coupon2" class="collapse" data-parent="#accordion">
                            <div class="checkout_info coupon_info">
                                <form asp-action="ApplyCoupon" asp-controller="Checkout" method="post">
                                    <input asp-for="@Model.ApplyCoupon.CouponCode" name="couponCode" placeholder="Coupon code" type="text">
                                    <button class="btn btn-primary" type="submit">
                                        Apply coupon
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="checkout_form">
            <div class="row">
                <div class="col-lg-7 col-md-6">
                    <form action="#">
                        <h3>Shipping Details</h3>
                        <div class="checkout_form_input">
                            <div class="checkout_form_input">
                                <label>Full Name <span>*</span></label>
                                <input type="text">
                            </div>
                            <div class="checkout_form_input">
                                <label> Email <span>*</span></label>
                                <input type="text">
                            </div>
                        </div>
                        <div class="checkout_form_input">
                            <label>Address<span>*</span></label>
                            <input type="text">
                        </div>
                        <div class="checkout_form_input">
                            <label>Town / City <span>*</span></label>
                            <input type="text">
                        </div>
                        <div class="checkout_form_input">
                            <label for="country">country <span>*</span></label>
                            <select class="select_option" name="cuntry" id="country">
                                <option value="Argentina">Argentina</option>
                                <option value="Australia">Australia</option>
                                <option value="Bangladesh">Bangladesh</option>
                                <option value="Brazil">Brazil</option>
                                <option value="Canada">Canada</option>
                                <option value="Chile">Chile</option>
                                <option value="China">China</option>
                                <option value="Colombia">Colombia</option>
                                <option value="Egypt">Egypt</option>
                                <option value="France">France</option>
                                <option value="Germany">Germany</option>
                                <option value="Ghana">Ghana</option>
                                <option value="India">India</option>
                                <option value="Indonesia">Indonesia</option>
                                <option value="Iran">Iran</option>
                                <option value="Iraq">Iraq</option>
                                <option value="Italy">Italy</option>
                                <option value="Japan">Japan</option>
                                <option value="Kenya">Kenya</option>
                                <option value="Malaysia">Malaysia</option>
                                <option value="Mexico">Mexico</option>
                                <option value="Morocco">Morocco</option>
                                <option value="Netherlands">Netherlands</option>
                                <option value="New Zealand">New Zealand</option>
                                <option value="Nigeria">Nigeria</option>
                                <option value="Pakistan">Pakistan</option>
                                <option value="Peru">Peru</option>
                                <option value="Philippines">Philippines</option>
                                <option value="Poland">Poland</option>
                                <option value="Portugal">Portugal</option>
                                <option value="Russia">Russia</option>
                                <option value="Saudi Arabia">Saudi Arabia</option>
                                <option value="Singapore">Singapore</option>
                                <option value="South Africa">South Africa</option>
                                <option value="South Korea">South Korea</option>
                                <option value="Spain">Spain</option>
                                <option value="Sweden">Sweden</option>
                                <option value="Switzerland">Switzerland</option>
                                <option value="Thailand">Thailand</option>
                                <option value="Turkey">Turkey</option>
                                <option value="Ukraine">Ukraine</option>
                                <option value="United Arab Emirates">United Arab Emirates</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="United States">United States</option>
                                <option value="Venezuela">Venezuela</option>
                                <option value="Vietnam">Vietnam</option>
                            </select>
                        </div>
                        <div class="checkout_form_input">
                            <label> Phone <span>*</span></label>
                            <input type="text">
                        </div>
                        <div class="checkout_form_input">
                            <label> Postal Code </label>
                            <input type="text">
                        </div>
                    </form>
                </div>
                <div class="col-lg-5 col-md-6">
                    <div class="order_table_right">
                        <form action="#">
                            <h3>Your order</h3>
                            <div class="order_table table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th class="text-right">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if (Model.Products.Any())
                                        {
                                            foreach (var product in Model.Products)
                                            {
                                                <tr>
                                                    <td>@product.Title x @product.Count </td>
                                                    <td class="text-right">$@product.RowSumPrice</td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td>Cart Subtotal</td>
                                            <td class="text-right">$@Model.Products.Sum(x => x.RowSumPrice)</td>
                                        </tr>
                                        @if (!string.IsNullOrWhiteSpace(Model.ApplyCoupon.CouponCode) && Model.ApplyCoupon.DiscountAmount > 0)
                                        {
                                            <tr>
                                                <td>Coupon - @Model.ApplyCoupon.CouponCode</td>
                                                <td class="text-right">@Model.ApplyCoupon.DiscountAmount%</td>
                                            </tr>
                                        }
                                        @if (Model.ShippingMethods != null && Model.ShippingMethods.Any())
                                        {
                                            <tr>
                                                <td colspan="2" style="padding: 15px 0;">
                                                    <div style="font-weight: 400; font-size: 14px; margin-bottom: 12px;">Shipping Method</div>
                                                    <div class="shipping-methods">
                                                        @for (int i = 0; i < Model.ShippingMethods.Count; i++)
                                                        {
                                                            var method = Model.ShippingMethods[i];
                                                            <div class="shipping-method-option" style="margin-bottom: 10px; padding: 10px; border: 1px solid #e8e8e8; border-radius: 4px; transition: all 0.3s ease;">
                                                                <label for="shipping_@i" style="margin: 0; cursor: pointer; display: flex; align-items: center; width: 100%;">
                                                                    <input class="shipping-method-radio" 
                                                                           type="radio" 
                                                                           name="shippingMethod" 
                                                                           id="shipping_@i" 
                                                                           value="@method.Name"
                                                                           data-price="@method.Price"
                                                                           style="margin-right: 10px; cursor: pointer;"
                                                                           @(i == 0 ? "checked" : "")>
                                                                    <div style="flex: 1;">
                                                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                                                            <span style="font-weight: 400; font-size: 14px; color: #333;">@method.Name</span>
                                                                            <span style="font-weight: 500; font-size: 14px; color: #333;">$@method.Price.ToString("F2")</span>
                                                                        </div>
                                                                        <div style="font-size: 12px; color: #666; margin-top: 4px;">
                                                                            Estimated delivery: @method.EstimatedDays days
                                                                        </div>
                                                                    </div>
                                                                </label>
                                                            </div>
                                                        }
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Shipping</td>
                                                <td class="text-right">$<span id="shippingPrice">@(Model.ShippingMethods.FirstOrDefault()?.Price.ToString("F2") ?? "0.00")</span></td>
                                            </tr>
                                        }
                                        <tr class="order_total">
                                            <th>Order Total</th>
                                            @{
                                                var subTotal = Model.Products.Sum(x => x.RowSumPrice);
                                                var discount = subTotal * (Model.ApplyCoupon.DiscountAmount / 100m);
                                                var shippingPrice = Model.ShippingMethods?.FirstOrDefault()?.Price ?? 0;
                                                var total = subTotal - discount + shippingPrice;
                                            }
                                            <td class="text-right">$<span id="orderTotal">@total?.ToString("F2")</span></td>
                                        </tr>
                                    </tfoot>
                                </table>
                                <div class="panel-default">
                                    <div class="panel_radio">
                                        <input id="payment1" name="check_method" type="radio"
                                               data-target="createp_account" />
                                        <span class="checkmark"></span>
                                    </div>

                                    <label for="payment1" data-toggle="collapse"
                                           data-target="#panel1">direct bank transfer</label>
                                    <div id="panel1" class="collapse show one"
                                         data-parent="#accordion">
                                        <div class="card-body1">
                                            <p>
                                                Donec sed odio dui. Nulla vitae elit libero, a phara
                                                etra augue. Nullam id dolor id nibh ultricies
                                                vehicula ut id elit.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-default">
                                    <div class="panel_radio">
                                        <input id="payment2" name="check_method" type="radio"
                                               data-target="createp_account" />
                                        <span class="checkmark"></span>
                                    </div>
                                    <label for="payment2" data-toggle="collapse"
                                           data-target="#method2">cheque payment</label>
                                    <div id="method2" class="collapse two" data-parent="#accordion">
                                        <div class="card-body1">
                                            <p>
                                                Donec sed odio dui. Nulla vitae elit libero, a phara
                                                etra augue. Nullam id dolor id nibh ultricies
                                                vehicula ut id elit.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-default">
                                    <div class="panel_radio">
                                        <input id="payment3" name="check_method" type="radio"
                                               data-target="createp_account" />
                                        <span class="checkmark"></span>
                                    </div>
                                    <label for="payment3" data-toggle="collapse"
                                           data-target="#method3">cash on delivery</label>
                                    <div id="method3" class="collapse three"
                                         data-parent="#accordion">
                                        <div class="card-body1">
                                            <p>
                                                Donec sed odio dui. Nulla vitae elit libero, a phara
                                                etra augue. Nullam id dolor id nibh ultricies
                                                vehicula ut id elit.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-default">
                                    <div class="panel_radio">
                                        <input id="payment4" name="check_method" type="radio"
                                               data-target="createp_account" />
                                        <span class="checkmark"></span>
                                    </div>
                                    <label for="payment4" data-toggle="collapse"
                                           data-target="#method4">Paypal</label>
                                    <div id="method4" class="collapse four"
                                         data-parent="#accordion">
                                        <div class="card-body1">
                                            <p>
                                                Donec sed odio dui. Nulla vitae elit libero, a phara
                                                etra augue. Nullam id dolor id nibh ultricies
                                                vehicula ut id elit.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="place_order_btn">
                                <a class="btn btn-primary" href="#">place order</a>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--Checkout page section end-->
@section Styles {
    <link href="~/assets/css/styles/checkout.css" rel="stylesheet" />
}
@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
    <script src="~/assets/js/scripts/checkout.js"></script>
    <script>
        const Toast = Swal.mixin({
                        toast: true,
                        position: "top-end",
                        showConfirmButton: false,
                        timer: 2000,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                        toast.onmouseenter = Swal.stopTimer;
                        toast.onmouseleave = Swal.resumeTimer;
                        }
                    });
    </script>
    @if (TempData["ErrorMessage"] is not null)
    {
        <script>
            Toast.fire({
                icon: "error",
                title: "@TempData["ErrorMessage"]?.ToString()"
            });
        </script>
    }
    @if (TempData["Success"] is not null)
    {
        <script>
            Toast.fire({
              icon: "success",
              title: "@TempData["Success"]?.ToString()"
            });
        </script>
    }
    <script>
        var subtotal = @Model.Products.Sum(x => x.RowSumPrice);
        var discountPercentage = @Model.ApplyCoupon.DiscountAmount;
        initializeCheckout(subtotal, discountPercentage);
    </script>

}

